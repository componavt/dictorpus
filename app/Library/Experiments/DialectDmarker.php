<?php

namespace App\Library\Experiments;

use Illuminate\Database\Eloquent\Model;

use App\Models\Dict\Dialect;

class DialectDmarker extends Model
{
    protected $table_name='dialect_dmarker';
    
    public static function dialectListByGroups() {
        return [
            'северные собственно карельские' => 
                [6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15],
            'южные собственно карельские' => 
                [/*48, 49,*/ 17, 18, 16, 19, 20/*, 21*/],
            'тверские собственно карельские' => 
                [25, 26, 27, 28, 29],
            'ливвиковские' => 
                [30, 31, 32, 33, 34, 35, 36, 37],
            'людиковские' => 
                [38, /*39,*/ 42, 41],
        ];
    }
    
    public static function rules() {
        return 
        $variants = [
                 1=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 21, 25, 26, 29, 34, 35, 38, 39, 42, 41],
                 2=>[18, 20, 19, 21, 28, 30, 33, 34],
                 3=>[16, 31, 32],
                 4=>[16, 19, 31],
                 5=>[36, 39],
                 6=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 21, 25, 26, 27, 29, 34, 35, 36, 38, 39, 42, 41],
                 7=>[19, 20, 21, 30, 32],
                 8=>[16, 19, 31],
                 9=>[32],
                 10=>[36],
                 11=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15], 
                 12=>[48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
                 13=>[6, 7, 8, 11, 10, 12, 50, 9, 14],
                 14=>[9, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
                 15=>[6, 7, 50, 9, 8, 11, 10, 12],
                 16=>[13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
//                 17=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21],
//                 18=>[30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
//                 19=>[30, 32, 33, 34, 36, 35, 38, 39, 42],
//                 20=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 31, 41],
//                 21=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 17, 18, 16, 30, 32, 33, 34, 36, 35, 38, 39, 42, 41],
//                 22=>[16, 19, 20, 21, 31],
//                 23=>[16, 19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37],
//                 24=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 17],
                 25=>[30, 31, 32, 33, 34, 35, 36, 37, 38, 39],
                 26=>[39, 42],
                 27=>[42],
                 28=>[41],
                 29=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21],            
//                 30=>[33, 30, 38, 39, 42],
//                 31=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 31, 32, 34, 36, 35, 41],
//                 32=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 18, 16, 17, 49, 48, 21, 33, 30, 34, 38, 39, 42],
//                 33=>[15, 20, 16, 19, 21, 31, 32, 36, 35, 41],
                 34=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29],
                 35=>[30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
                 36=>[29, 38, 39, 41],
                 37=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37, 42],
//                 38=>[38, 39],
//                 39=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37, 42],
                 40=>[17, 16, 18, 19, 20, 21, 32, 31, 33, 30, 38, 39, 42, 41],
                 41=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49,  17, 16, 25, 26, 27, 28, 29, 34, 36, 35, 32, 31, 33, 30],
                 42=>[8, 11, 10, 12, 14, 13, 17, 49, 16, 18, 19, 20, 21, 32, 34, 36, 35, 38],
                 43=>[6, 7, 50, 9, 15, 48, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
                 44=>[16, 19, 20, 21, 30, 32, 38, 39, 42, 41],
                 45=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 16, 19, 20, 36, 35, 34, 31, 33, 32],
//                 46=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 16, 19, 20, 21, 36, 35, 34, 33, 32],
//                 47=>[16, 19, 20, 21, 48, 33, 31, 38, 39, 42, 41],
                 48=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 28, 36, 35, 34, 30, 39, 42],
                 49=>[25, 26, 27, 29, 32, 33, 31, 38, 41],
                 50=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 16, 18, 19, 25, 26, 27, 28, 29],
                 51=>[19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
                 52=>[6, 7, 50, 8, 10, 11, 12, 13, 48, 49, 17, 16, 18, 21, 25, 26, 28, 29, 38, 39],
                 53=>[9, 14, 16, 19, 20, 21, 27, 30, 31, 32, 33, 34, 35, 36, 37, 39, 42, 41],
                 54=>[6, 7, 50, 8, 10, 11, 12, 13, 48, 49, 17, 16, 18, 20, 21, 26, 28, 29, 38, 39],
                 55=>[9, 14, 16, 19, 21, 25, 27, 30, 31, 32, 33, 34, 35, 36, 37, 39, 42, 41],
//                 56=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37],
//                 57=>[38, 39, 42, 41],
                 58=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 16, 48, 17, 18, 19, 25, 26, 27, 28, 29, 49],
                 59=>[19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42, 41],
//                 60=>[38, 41],
//                 61=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 30, 31, 32, 33, 34, 35, 36, 37, 39, 42],
//                 62=>[30, 31, 32, 33, 34, 35, 36, 37, 42],
//                 63=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 38, 39, 41],
//                 64=>[8, 11, 10, 30, 31, 32, 33, 34, 35, 36, 37, 42],
//                 65=>[6, 7, 50, 9, 14, 12, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21],
//                 66=>[38, 39, 41],
                 67=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29],
                 68=>[30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 42],
                 69=>[41],
                 70=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29],
                 71=>[30, 31, 32, 33, 34, 35, 36, 37, 42, 41],
                 72=>[38, 39],
                 73=>[6, 7, 50, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 29],
                 74=>[30, 31, 32, 33, 34, 35, 36, 37],
                 75=>[38, 39, 42, 41],
                 76=>[29, 36],
                 77=>[6, 7, 9, 8, 10, 11, 12, 13, 14, 15, 48, 49, 17, 18, 16, 19, 20, 21, 25, 26, 27, 28, 30, 31, 32, 33, 34, 35, 37, 38, 39, 42, 41, 50],
                 78=>[30, 31, 32, 33, 34, 35, 36, 37, 42],            
                 79=>[27, 37],
                 80=>[28],
            
        ];        
    }
    
    public static function init() {
        $gr_dialects = $dialects = [];
        foreach (DialectDmarker::dialectListByGroups() as $gr_name => $dialect_grs) {
            $gr_dialects[$gr_name] = sizeof($dialect_grs);
            foreach ($dialect_grs as $dialect_id) {
                $dialect = Dialect::find($dialect_id);
                $dialects[$dialect_id] = [
                    'name' => $dialect->name,
                    'text_total' => $dialect->totalTexts(),
                    'word_total' => $dialect->totalWords()
                ];
            }
        }                    
        $dmarkers = Dmarker::orderBy('id')->get();
        return [$dialects, $dmarkers, $gr_dialects];
    }
    
    public static function updateData($mvariant_id, $dmarker_id, $dialect_id, $t_frequency, $t_fraction, $w_frequency, $w_fraction) {
        if (DB::table('dialect_dmarker')->whereMvariantId($this->id)->whereDialectId($dialect_id)->count()) {
            DB::statement('UPDATE dialect_dmarker SET t_frequency='.$t_frequency.', t_fraction='.$t_fraction
                    . ', w_frequency='.$w_frequency.', w_fraction='.$w_fraction
                    . ' where mvariant_id='. $mvariant_id. ' and dialect_id='.$dialect_id);
        } else {
            DB::table('dialect_dmarker')->insert([
                'dialect_id' => $dialect_id, 
                'dmarker_id' => $dmarker_id, 
                'mvariant_id' => $mvariant_id, 
                't_frequency' => $t_frequency,
                't_fraction' => $t_fraction,
                'w_frequency' => $w_frequency,
                'w_fraction' => $w_fraction]);
        }        
    }
}
